
@{
    ViewBag.Title = "cVotants";
}
<script>
        function loadVotation() {
            $.get("/cv/ApiVotation/VotationCreated", function (data, status) {
                $.each(data, function (key, votation) {
                    $("#cboVotation").append('<option value=' + votation.id + '>' + votation.title + '</option>');
                });
            });
    }
        function downloadTemplate(file) {
        window.location = '/cv/ApiVotation/DownloadTemplate?file=' + file;
    }

        function ImportCSV() {

        if (window.FormData !== undefined) {
            var fileUpload = $("#txtfile").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            fileData.append('VotationId', $("#cboVotation").val());

            $.ajax({
                url: '/cv/ApiVotation/UploadFileVotants',
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    alert("CSV insertado correctamente");
                    loadQuestion();
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }
        else {
            alert("FormData is not supported.");
        }
    }

        function registerVotantes() {
            var userVote = {
                login: $("#txtusuario").val(),
                password: $("#txtpassword").val(),
                typeUserid: 3,
                votationid: $("#cboVotation").val(),
                nameUser: $("#txtnombre").val(),
                lastnameUser: $("#txtapellido").val(),
                dni: $("#txtdni").val()
        }
        var json = JSON.stringify(userVote);
        console.log(userVote);

        $.ajax({
            url: '/cv/ApiVotation/CreateUserVotation',
            type: 'post',
            dataType: 'JSON',
            contentType: 'application/json; charset=utf-8',
            data: json,
            success: function (data, textStatus, jQxhr) {
                alert("Votante creado correctamente");
                clearElments();
                },
            error: function (jqXhr, textStatus, errorThrown) {
                console.log("error es "+errorThrown);
                    alert("Error al crear la Opciones");
                }
        });
    }

    function clearElments() {
        $("#txtnombre").val("");
        $("#txtapellido").val("");
        $("#txtdni").val("");
        $("#txtusuario").val("");
        $("#txtpassword").val("");
    }

        window.onload = function () {
        loadVotation();
    }
</script>
<div class="card">
    <div class="card-body">
        <h4 class="box-title">Votantes </h4>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body">
                <form>
                    <div class="form-group row">
                        <label for="staticEmail" class="col-sm-4 col-form-label">Votaciòn</label>
                        <div class="col-sm-6">
                            <select class="form-control" id="cboVotation">
                                <option value="0">Seleccione</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div> <!-- /.row -->
    </div>
</div>
<div class="card">
    <div class="card-body">
        <h4 class="box-title">Importar Votantes </h4>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body">
                <form>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">CSV</label>
                        <div class="col-sm-6">
                            <input type="file" class="form-control-file" id="txtfile">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1"></label>
                        <div class="col-sm-6">
                            <input type="button" onclick="downloadTemplate('tmpvotantes.csv');" class="btn btn-success" value="Descargar Plantilla">
                            <input type="button" onclick="ImportCSV();" class="btn btn-success" value="Subir CSV">
                        </div>
                    </div>
                </form>
            </div>
        </div> <!-- /.row -->
    </div>
</div>
<div class="card">
    <div class="card-body">
        <h4 class="box-title">Crear Votante</h4>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card-body">
                <form>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">Nombre</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="txtnombre">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">Apellidos</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="txtapellido">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">DNI</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="txtdni">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">Usuario</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="txtusuario">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1">Contraseña</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="txtpassword">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="exampleFormControlFile1"></label>
                        <div class="col-sm-6">
                            <input type="button" onclick="registerVotantes();" class="btn btn-success" value="Registrar Votante">
                        </div>
                    </div>
                </form>
            </div>
        </div> <!-- /.row -->
    </div>
</div>